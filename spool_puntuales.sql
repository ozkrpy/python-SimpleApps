SET VERIFY OFF
SET HEADING OFF
SET FEEDBACK OFF
SET AUTOTRACE OFF
SET LINESIZE 32767
SET PAGESIZE 0
SET TAB ON
SET TERM OFF
SET TRIMSPOOL ON
SET TIME ON
SET SERVEROUTPUT ON
SET DEFINE ON

ALTER SESSION SET NLS_DATE_FORMAT = "DD/MM/YYYY HH24:MI:SS"
/
spool /oracle/TratamientoPuntuales/Puntual-kmlresh-dbadmin.sql
/
DECLARE
    nombre_db VARCHAR(32767) := 'kmlresh';
    cadena_columnas VARCHAR(32767);
    cadena_select VARCHAR(32767);
    contador NUMBER;
    query_conteo VARCHAR(32767);
    listado_tablas CLOB;
    v_buff VARCHAR(32767);
    
    output_spool_tabla VARCHAR(32767) := '';
    select_spool_columnas VARCHAR(32767) := '';
    select_spool_datos VARCHAR(32767) := '';
    
    CURSOR tablas IS 
        SELECT t.owner, t.table_name
        FROM all_tables t
        WHERE t.owner in ('DBADMIN')
        -- AND t.table_name in (
        --     'CLUBP_ACUMULADO_EVENTO_HIS','FCT_CARGA_2012_03','FCT_CARGA_2012_04','FCT_CARGA_2012_05','FCT_CARGA_2012_06','FCT_CARGA_2012_07','FCT_CARGA_2012_08','FCT_CARGA_2012_09','FCT_CARGA_2012_10','FCT_CARGA_2013_03','FCT_CARGA_2013_04','FCT_CARGA_2013_05','FCT_CARGA_2013_06','FCT_CARGA_2013_07','FCT_CARGA_2013_08','FCT_CARGA_2013_09','FCT_CARGA_2013_10','FCT_CARGA_2013_11','FCT_CARGA_2013_12','FCT_CARGA_2014_01','FCT_CARGA_2014_02','FCT_CARGA_2014_03','FCT_CARGA_2014_04','FCT_CARGA_2014_05','FCT_CARGA_2014_06','FCT_CARGA_2014_07','FCT_CARGA_2014_08','FCT_CARGA_2014_09','FCT_CARGA_2014_10','FCT_CARGA_2014_11','FCT_CARGA_2014_12','FCT_CARGA_2015_01','FCT_CARGA_2015_02','FCT_CARGA_2015_03','FCT_CARGA_2015_04','FCT_CARGA_2015_05','FCT_CARGA_2015_06','FCT_CARGA_2015_07','FCT_CARGA_2015_08','FCT_CARGA_2015_09','FCT_CARGA_2015_10','FCT_CARGA_2016_11','FCT_CARGA_2016_12','FCT_CARGA_2017_01','FCT_CARGA_2017_03','FCT_CARGA_2017_04','FCT_CARGA_2017_05','FCT_CARGA_2017_07','FCT_CARGA_2017_08','FCT_CARGA_2017_09','FCT_CARGA_2017_10','FCT_CARGA_2017_11','FCT_CARGA_2017_12','FCT_CARGA_2018_01','FCT_CARGA_2018_02','FCT_CARGA_2018_03','FCT_CARGA_2018_04','FCT_CARGA_2018_05','FCT_CARGA_2018_06','FCT_CARGA_2018_07','FCT_CARGA_2018_08','FCT_CARGA_2018_09','FCT_CARGA_2018_10','FCT_CARGA_2018_11','FCT_CARGA_2018_12','FCT_DET_CARGA_2015_09','FCT_DET_CARGA_2015_10','FCT_DET_CARGA_2015_11','FCT_DET_CARGA_2016_01','FCT_DET_CARGA_2016_02','FCT_DET_CARGA_2016_04','FCT_DET_CARGA_2016_06','FCT_DET_CARGA_2017_01','FCT_DET_CARGA_2017_02','FCT_LINEA_SERV_2013_04','FCT_LINEA_SERV_2013_05','FCT_LINEA_SERV_2013_06','FCT_LINEA_SERV_2013_07','FCT_LINEA_SERV_2013_08','FCT_LINEA_SERV_2013_09','FCT_LINEA_SERV_2013_10','FCT_LINEA_SERV_2013_11','FCT_LINEA_SERV_2013_12','FCT_LINEA_SERV_2014_01','FCT_LINEA_SERV_2014_02','FCT_LINEA_SERV_2014_03','FCT_LINEA_SERV_2014_04','FCT_LINEA_SERV_2014_05','FCT_LINEA_SERV_2014_06','FCT_LINEA_SERV_2014_07','FCT_LINEA_SERV_2014_08','FCT_LINEA_SERV_2014_09','FCT_LINEA_SERV_2014_10','FCT_LINEA_SERV_2014_11','FCT_LINEA_SERV_2014_12','FCT_PEDIDO_2012_05','FCT_TRAFICO_2007_11','FCT_TRAFICO_2007_12','FCT_TRAFICO_2008_01','FCT_TRAFICO_2008_02','FCT_TRAFICO_2008_03',
        --     'FCT_TRAFICO_2008_04','FCT_TRAFICO_2008_05','FCT_TRAFICO_2008_06','FCT_TRAFICO_2008_07','FCT_TRAFICO_2008_08','FCT_TRAFICO_2008_09','FCT_TRAFICO_2008_10','FCT_TRAFICO_2008_11','FCT_TRAFICO_2008_12','FCT_TRAFICO_2009_01','FCT_TRAFICO_2009_02','FCT_TRAFICO_2009_03','FCT_TRAFICO_2009_04','FCT_TRAFICO_2009_05','FCT_TRAFICO_2009_06','FCT_TRAFICO_2009_07','FCT_TRAFICO_2009_08','FCT_TRAFICO_2009_09','FCT_TRAFICO_2009_10','FCT_TRAFICO_2009_11','FCT_TRAFICO_2009_12','FCT_TRAFICO_2010_01','FCT_TRAFICO_2010_02','FCT_TRAFICO_2010_03','FCT_TRAFICO_2010_04','FCT_TRAFICO_2010_05','FCT_TRAFICO_2010_06','FCT_TRAFICO_2010_07','FCT_TRAFICO_2010_08','FCT_TRAFICO_2010_09','FCT_TRAFICO_2010_10','FCT_TRAFICO_2010_11','FCT_TRAFICO_2010_12','FCT_TRAFICO_2011_01','FCT_TRAFICO_2011_02','FCT_TRAFICO_2011_03','FCT_TRAFICO_2011_04','FCT_TRAFICO_2011_05','FCT_TRAFICO_2011_06','FCT_TRAFICO_2011_07','FCT_TRAFICO_2011_08','FCT_TRAFICO_2011_09','FCT_TRAFICO_2011_10','FCT_TRAFICO_2011_11','FCT_TRAFICO_2011_12','FCT_TRAFICO_2012_01','FCT_TRAFICO_2012_02','FCT_TRAFICO_2012_03','FCT_TRAFICO_2012_04','FCT_TRAFICO_2012_05','FCT_TRAFICO_2012_06','FCT_TRAFICO_2012_07','FCT_TRAFICO_2012_08','FCT_TRAFICO_2012_09','FCT_TRAFICO_2012_10','FCT_TRAFICO_2012_11','FCT_TRAFICO_2012_12','FCT_TRAFICO_2013_01','FCT_TRAFICO_2013_02','FCT_TRAFICO_2013_03','FCT_TRAFICO_2013_04','FCT_TRAFICO_2013_05','FCT_TRAFICO_2013_06','FCT_TRAFICO_2013_07','FCT_TRAFICO_2013_08','FCT_TRAFICO_2013_09','FCT_TRAFICO_2013_10','FCT_TRAFICO_2013_11','FCT_TRAFICO_2013_12','FCT_TRAFICO_2014_01','FCT_TRAFICO_2014_02','FCT_TRAFICO_2014_03','FCT_TRAFICO_2014_04','FCT_TRAFICO_2014_05','FCT_TRAFICO_2014_06','FCT_TRAFICO_2014_07','FCT_TRAFICO_2014_08','FCT_TRAFICO_2014_09','FCT_TRAFICO_2014_10','FCT_TRAFICO_2014_11','FCT_TRAFICO_2014_12','FCT_TRAFICO_2015_01','FCT_TRAFICO_2015_02','FCT_TRAFICO_2015_03','FCT_TRAFICO_2015_04','FCT_TRAFICO_2015_05','FCT_TRAFICO_2015_06','FCT_TRAFICO_2015_07','FCT_TRAFICO_2015_08','FCT_TRAFICO_2015_09','FCT_TRAFICO_2015_10','FCT_TRAFICO_2015_11','FCT_TRAFICO_2015_12','FCT_TRAFICO_2016_01','FCT_TRAFICO_2016_02','FCT_TRAFICO_2016_03','FCT_TRAFICO_2016_04','FCT_TRAFICO_GPRS_2007_11','FCT_TRAFICO_GPRS_2008_04','FCT_TRAFICO_GPRS_2008_05',
        --     'FCT_TRAFICO_GPRS_2008_06','FCT_TRAFICO_GPRS_2008_07','FCT_TRAFICO_GPRS_2008_08','FCT_TRAFICO_GPRS_2008_09','FCT_TRAFICO_GPRS_2008_10','FCT_TRAFICO_GPRS_2008_11','FCT_TRAFICO_GPRS_2008_12','FCT_TRAFICO_GPRS_2009_01','FCT_TRAFICO_GPRS_2009_02','FCT_TRAFICO_GPRS_2009_10','FCT_TRAFICO_GPRS_2009_11','FCT_TRAFICO_GPRS_2009_12','FCT_TRAFICO_GPRS_2010_01','FCT_TRAFICO_GPRS_2010_02','FCT_TRAFICO_GPRS_2010_03','FCT_TRAFICO_GPRS_2010_04','FCT_TRAFICO_GPRS_2010_05','FCT_TRAFICO_GPRS_2010_06','FCT_TRAFICO_GPRS_2010_07','FCT_TRAFICO_GPRS_2010_08','FCT_TRAFICO_GPRS_2010_09','FCT_TRAFICO_GPRS_2010_10','FCT_TRAFICO_GPRS_2010_11','FCT_TRAFICO_GPRS_2010_12','FCT_TRAFICO_GPRS_2011_01','FCT_TRAFICO_GPRS_2011_02','FCT_TRAFICO_GPRS_2011_03','FCT_TRAFICO_GPRS_2011_04','FCT_TRAFICO_GPRS_2011_05','FCT_TRAFICO_GPRS_2011_06','FCT_TRAFICO_GPRS_2011_07','FCT_TRAFICO_GPRS_2011_08','FCT_TRAFICO_GPRS_2011_09','FCT_TRAFICO_GPRS_2011_10','FCT_TRAFICO_GPRS_2011_11','FCT_TRAFICO_GPRS_2011_12','FCT_TRAFICO_GPRS_2012_01','FCT_TRAFICO_GPRS_2012_02','FCT_TRAFICO_GPRS_2012_03','FCT_TRAFICO_GPRS_2012_04','FCT_TRAFICO_GPRS_2012_05','FCT_TRAFICO_GPRS_2012_06','FCT_TRAFICO_GPRS_2012_07','FCT_TRAFICO_GPRS_2012_08','FCT_TRAFICO_GPRS_2012_09','FCT_TRAFICO_GPRS_2012_10','FCT_TRAFICO_GPRS_2012_11','FCT_TRAFICO_GPRS_2012_12','FCT_TRAFICO_GPRS_2013_01','FCT_TRAFICO_GPRS_2013_02','FCT_TRAFICO_GPRS_2013_03','FCT_TRAFICO_GPRS_2013_04','FCT_TRAFICO_GPRS_2013_05','FCT_TRAFICO_GPRS_2013_06','FCT_TRAFICO_GPRS_2013_07','FCT_TRAFICO_GPRS_2013_08','FCT_TRAFICO_GPRS_2013_09','FCT_TRAFICO_GPRS_2013_10','FCT_TRAFICO_GPRS_2013_11','FCT_TRAFICO_GPRS_2013_12','FCT_TRAFICO_SMS_2004_12','FCT_TRAFICO_SMS_2005_01','FCT_TRAFICO_SMS_2005_02','FCT_TRAFICO_SMS_2005_03','FCT_TRAFICO_SMS_2005_04','FCT_TRAFICO_SMS_2005_05','FCT_TRAFICO_SMS_2005_06','FCT_TRAFICO_SMS_2005_07','FCT_TRAFICO_SMS_2005_08','FCT_TRAFICO_SMS_2005_09','FCT_TRAFICO_SMS_2005_10','FCT_TRAFICO_SMS_2005_11','FCT_TRAFICO_SMS_2005_12','FCT_TRAFICO_SMS_2006_01','FCT_TRAFICO_SMS_2006_02','FCT_TRAFICO_SMS_2006_03','FCT_TRAFICO_SMS_2006_04','FCT_TRAFICO_SMS_2006_05','FCT_TRAFICO_SMS_2006_06','FCT_TRAFICO_SMS_2006_07','FCT_TRAFICO_SMS_2006_08','FCT_TRAFICO_SMS_2006_09','FCT_TRAFICO_SMS_2006_10','FCT_TRAFICO_SMS_2006_11','FCT_TRAFICO_SMS_2006_12','FCT_TRAFICO_SMS_2007_01','FCT_TRAFICO_SMS_2007_02','FCT_TRAFICO_SMS_2007_03','FCT_TRAFICO_SMS_2007_04','FCT_TRAFICO_SMS_2007_05',
        --     'FCT_TRAFICO_SMS_2007_06','FCT_TRAFICO_SMS_2007_07','FCT_TRAFICO_SMS_2007_08','FCT_TRAFICO_SMS_2007_09','FCT_TRAFICO_SMS_2007_10','FCT_TRAFICO_SMS_2007_11','FCT_TRAFICO_SMS_2007_12','FCT_TRAFICO_SMS_2008_01','FCT_TRAFICO_SMS_2008_02','FCT_TRAFICO_SMS_2008_03',
        --     'FCT_TRAFICO_SMS_2008_04','FCT_TRAFICO_SMS_2008_05','FCT_TRAFICO_SMS_2008_06','FCT_TRAFICO_SMS_2008_07','FCT_TRAFICO_SMS_2008_08','FCT_TRAFICO_SMS_2008_09','FCT_TRAFICO_SMS_2008_10','FCT_TRAFICO_SMS_2008_11','FCT_TRAFICO_SMS_2008_12','FCT_TRAFICO_SMS_2009_01','FCT_TRAFICO_SMS_2009_02','FCT_TRAFICO_SMS_2009_03','FCT_TRAFICO_SMS_2009_04','FCT_TRAFICO_SMS_2009_05','FCT_TRAFICO_SMS_2009_06','FCT_TRAFICO_SMS_2009_07','FCT_TRAFICO_SMS_2009_08','FCT_TRAFICO_SMS_2009_09','FCT_TRAFICO_SMS_2009_10','FCT_TRAFICO_SMS_2009_11','FCT_TRAFICO_SMS_2009_12','FCT_TRAFICO_SMS_2010_01','FCT_TRAFICO_SMS_2010_02','FCT_TRAFICO_SMS_2010_03','FCT_TRAFICO_SMS_2010_04','FCT_TRAFICO_SMS_2010_05','FCT_TRAFICO_SMS_2010_06','FCT_TRAFICO_SMS_2010_07','FCT_TRAFICO_SMS_2010_08','FCT_TRAFICO_SMS_2010_09','FCT_TRAFICO_SMS_2010_10','FCT_TRAFICO_SMS_2010_11','FCT_TRAFICO_SMS_2010_12','FCT_TRAFICO_SMS_2011_01','FCT_TRAFICO_SMS_2011_02','FCT_TRAFICO_SMS_2011_03','FCT_TRAFICO_SMS_2011_04','FCT_TRAFICO_SMS_2011_05','FCT_TRAFICO_SMS_2011_06','FCT_TRAFICO_SMS_2011_07','FCT_TRAFICO_SMS_2011_08','FCT_TRAFICO_SMS_2011_09','FCT_TRAFICO_SMS_2011_10','FCT_TRAFICO_SMS_2011_11','FCT_TRAFICO_SMS_2011_12','FCT_TRAFICO_SMS_2012_01','FCT_TRAFICO_SMS_2012_02','FCT_TRAFICO_SMS_2012_03','FCT_TRAFICO_SMS_2012_04','FCT_TRAFICO_SMS_2012_05','FCT_TRAFICO_SMS_2012_06','FCT_TRAFICO_SMS_2012_07','FCT_TRAFICO_SMS_2012_08','FCT_TRAFICO_SMS_2012_09','FCT_TRAFICO_SMS_2012_10','FCT_TRAFICO_SMS_2012_11','FCT_TRAFICO_SMS_2012_12','FCT_TRAFICO_SMS_2013_01','FCT_TRAFICO_SMS_2013_02','FCT_TRAFICO_SMS_2013_03','FCT_TRAFICO_SMS_2013_04','FCT_TRAFICO_SMS_2013_05','FCT_TRAFICO_SMS_2013_06','FCT_TRAFICO_SMS_2013_07','FCT_TRAFICO_SMS_2013_08','FCT_TRAFICO_SMS_2013_09','FCT_TRAFICO_SMS_2013_10','FCT_TRAFICO_SMS_2013_11','FCT_TRAFICO_SMS_2013_12','FCT_TRAFICO_SMS_2014_01','FCT_TRAFICO_SMS_2014_02','FCT_TRAFICO_SMS_2014_03','FCT_TRAFICO_SMS_2014_04','FCT_TRAFICO_SMS_2014_05','FCT_TRAFICO_SMS_2014_06','FCT_TRAFICO_SMS_2014_07','FCT_TRAFICO_SMS_2014_08','FCT_TRAFICO_SMS_2014_09','FCT_TRAFICO_SMS_2014_10','FCT_TRAFICO_SMS_2014_11',
        --     'FCT_TRAFICO_SMS_2014_12','FCT_TRAFICO_SMS_2015_01','FCT_TRAFICO_SMS_2015_02','FCT_TRAFICO_SMS_2015_03','FCT_TRAFICO_SMS_2015_04','FCT_TRAFICO_SMS_2015_05','FCT_TRAFICO_SMS_2015_06','FCT_TRAFICO_SMS_2015_07','FCT_TRAFICO_SMS_2015_08','FCT_TRAFICO_SMS_2015_09','FCT_TRAFICO_SMS_2015_10','FCT_TRAFICO_SMS_2015_11','FCT_TRAFICO_SMS_2015_12','FCT_TRAFICO_SMS_2016_01','FCT_TRAFICO_SMS_2016_02','FCT_TRAFICO_SMS_2016_03','FCT_TRAFICO_SMS_2016_04','FCT_TRAFICO_SMS_SVA_2005_10','FCT_TRAFICO_SMS_SVA_2005_11','FCT_TRAFICO_SMS_SVA_2005_12','FCT_TRAFICO_SMS_SVA_2006_03','FCT_TRAFICO_SMS_SVA_2006_04','FCT_TRAFICO_SMS_SVA_2006_05','FCT_TRAFICO_SMS_SVA_2006_06','FCT_TRAFICO_SMS_SVA_2007_06','FCT_TRAFICO_SMS_SVA_2007_07','FCT_TRAFICO_SMS_SVA_2007_08','FCT_TRAFICO_SMS_SVA_2007_09','FCT_TRAFICO_SMS_SVA_2007_10','FCT_TRAFICO_SMS_SVA_2007_11','FCT_TRAFICO_SMS_SVA_2007_12','FCT_TRAFICO_SMS_SVA_2008_01','FCT_TRAFICO_SMS_SVA_2008_02','FCT_TRAFICO_SMS_SVA_2008_03','FCT_TRAFICO_SMS_SVA_2008_04','FCT_TRAFICO_SMS_SVA_2008_05','FCT_TRAFICO_SMS_SVA_2008_06','FCT_TRAFICO_SMS_SVA_2008_07','FCT_TRAFICO_SMS_SVA_2008_08','FCT_TRAFICO_SMS_SVA_2008_09','FCT_TRAFICO_SMS_SVA_2008_10','FCT_TRAFICO_SMS_SVA_2008_11','FCT_TRAFICO_SMS_SVA_2008_12','FCT_TRAFICO_SMS_SVA_2009_01','FCT_TRAFICO_SMS_SVA_2009_02','FCT_TRAFICO_SMS_SVA_2009_03','FCT_TRAFICO_SMS_SVA_2009_04','FCT_TRAFICO_SMS_SVA_2009_05','FCT_TRAFICO_SMS_SVA_2009_06','FCT_TRAFICO_SMS_SVA_2009_07','FCT_TRAFICO_SMS_SVA_2009_08','FCT_TRAFICO_SMS_SVA_2009_09','FCT_TRAFICO_SMS_SVA_2009_10','FCT_TRAFICO_SMS_SVA_2009_11','FCT_TRAFICO_SMS_SVA_2009_12','FCT_TRAFICO_SMS_SVA_2010_01','FCT_TRAFICO_SMS_SVA_2010_02','FCT_TRAFICO_SMS_SVA_2010_03','FCT_TRAFICO_SMS_SVA_2010_04','FCT_TRAFICO_SMS_SVA_2010_05','FCT_TRAFICO_SMS_SVA_2010_06','FCT_TRAFICO_SMS_SVA_2010_07','FCT_TRAFICO_SMS_SVA_2010_08','FCT_TRAFICO_SMS_SVA_2010_09','FCT_TRAFICO_SMS_SVA_2010_10','FCT_TRAFICO_SMS_SVA_2010_11','FCT_TRAFICO_SMS_SVA_2010_12','FCT_TRAFICO_SMS_SVA_2011_01','FCT_TRAFICO_SMS_SVA_2011_02','FCT_TRAFICO_SMS_SVA_2011_03','FCT_TRAFICO_SMS_SVA_2011_04','FCT_TRAFICO_SMS_SVA_2011_05','FCT_TRAFICO_SMS_SVA_2011_06','FCT_TRAFICO_SMS_SVA_2011_07','FCT_TRAFICO_SMS_SVA_2011_08','FCT_TRAFICO_SMS_SVA_2011_09','FCT_TRAFICO_SMS_SVA_2011_10','FCT_TRAFICO_SMS_SVA_2011_11','FCT_TRAFICO_SMS_SVA_2011_12','FCT_TRAFICO_SMS_SVA_2012_01',
        --     'FCT_TRAFICO_SMS_SVA_2012_02','FCT_TRAFICO_SMS_SVA_2012_03','FCT_TRAFICO_SMS_SVA_2012_04','FCT_TRAFICO_SMS_SVA_2012_05','FCT_TRAFICO_SMS_SVA_2012_06','FCT_TRAFICO_SMS_SVA_2012_07','FCT_TRAFICO_SMS_SVA_2012_08','FCT_TRAFICO_SMS_SVA_2012_09','FCT_TRAFICO_SMS_SVA_2012_10','FCT_TRAFICO_SMS_SVA_2012_11','FCT_TRAFICO_SMS_SVA_2012_12','FCT_TRAFICO_SMS_SVA_2013_01','FCT_TRAFICO_SMS_SVA_2013_02','FCT_TRAFICO_SMS_SVA_2013_03','FCT_TRAFICO_SMS_SVA_2013_04','FCT_TRAFICO_SMS_SVA_2013_05','FCT_TRAFICO_SMS_SVA_2013_06','FCT_TRAFICO_SMS_SVA_2013_07','FCT_TRAFICO_SMS_SVA_2013_08','FCT_TRAFICO_SMS_SVA_2013_09','FCT_TRAFICO_SMS_SVA_2013_10','FCT_TRAFICO_SMS_SVA_2013_11','FCT_TRAFICO_SMS_SVA_2013_12','FCT_TRAFICO_SMS_SVA_2014_01','FCT_TRAFICO_SMS_SVA_2014_02','FCT_TRAFICO_SMS_SVA_2014_03','FCT_TRAFICO_SMS_SVA_2014_04','FCT_TRAFICO_SMS_SVA_2014_05','FCT_TRAFICO_SMS_SVA_2014_06','FCT_TRAFICO_SMS_SVA_2014_07','FCT_TRAFICO_SMS_SVA_2014_08','FCT_TRAFICO_SMS_SVA_2014_09','FCT_TRAFICO_SMS_SVA_2014_10','FCT_TRAFICO_SMS_SVA_2014_11','FCT_TRAFICO_SMS_SVA_2014_12','FCT_TRAFICO_SMS_SVA_2015_01','FCT_TRAFICO_SMS_SVA_2015_02','FCT_TRAFICO_SMS_SVA_2015_03','FCT_TRAFICO_SMS_SVA_2015_04','FCT_TRAFICO_SMS_SVA_2015_05','FCT_TRAFICO_SMS_SVA_2015_06','FCT_TRAFICO_SMS_SVA_2015_07','FCT_TRAFICO_SMS_SVA_2015_08','FCT_TRAFICO_SMS_SVA_2015_09','FCT_TRAFICO_SMS_SVA_2015_10','FCT_TRAFICO_SMS_SVA_2015_11','FCT_TRAFICO_SMS_SVA_2015_12','FCT_TRAFICO_SMS_SVA_2016_01','FCT_TRAFICO_SMS_SVA_2016_02','FCT_TRAFICO_SMS_SVA_2016_03','FCT_TRAFICO_SVA_REV_2014_09','FCT_TRAFICO_SVA_REV_2014_11','FCT_TRAFICO_SVA_REV_2015_01','FCT_TRAFICO_SVA_REV_2015_03','FCT_TRAFICO_SVA_REV_2015_07','FCT_TRAFICO_SVA_REV_2015_08','FCT_TRAFICO_SVA_REV_2015_09','FCT_TRAFICO_SVA_REV_2015_10','FCT_TRAFICO_SVA_REV_2015_11','FCT_TRAFICO_SVA_REV_2015_12','FCT_TRAF_GPRS_HB_2013_12','FCT_TRAF_GPRS_HB_2014_01','FCT_TRAF_GPRS_HB_2014_02','FCT_TRAF_GPRS_HB_2014_03','FCT_TRAF_GPRS_HB_2014_04','FCT_TRAF_GPRS_HB_2014_05','FCT_TRAF_GPRS_HB_2014_06','FCT_TRAF_GPRS_HB_2014_07','FCT_TRAF_GPRS_HB_2014_08','FCT_TRAF_GPRS_HB_2014_09','FCT_TRAF_GPRS_HB_2014_10','FCT_TRAF_GPRS_HB_2014_11','FCT_TRAF_GPRS_HB_2014_12','FCT_TRAF_GPRS_HB_2015_01','FCT_TRAF_GPRS_HB_2015_02','FCT_TRAF_GPRS_HB_2015_03','FCT_TRAF_GPRS_HB_2015_04','FCT_TRAF_GPRS_HB_2015_05','FCT_TRAF_GPRS_HB_2015_06','FCT_TRAF_GPRS_HB_2015_07',
        --     'FCT_TRAF_GPRS_HB_2015_08','FCT_TRAF_GPRS_HB_2015_09','FCT_TRAF_GPRS_HB_2015_10','FCT_TRAF_GPRS_HB_2015_11','FCT_TRAF_GPRS_HB_2015_12','FCT_TRAF_GPRS_HB_2016_01','FCT_TRAF_GPRS_HB_2016_02','FCT_TRAF_GPRS_HB_2016_03','FCT_TRAF_GPRS_HB_2016_04','FCT_TRAF_GPRS_TAS_2013_12','FCT_TRAF_GPRS_TAS_2014_01','FCT_TRAF_GPRS_TAS_2014_02','FCT_TRAF_GPRS_TAS_2014_03','FCT_TRAF_GPRS_TAS_2014_04','FCT_TRAF_GPRS_TAS_2014_05','FCT_TRAF_GPRS_TAS_2014_06','FCT_TRAF_GPRS_TAS_2014_07','FCT_TRAF_GPRS_TAS_2014_08','FCT_TRAF_GPRS_TAS_2014_09','FCT_TRAF_GPRS_TAS_2014_10','FCT_TRAF_GPRS_TAS_2014_11','FCT_TRAF_GPRS_TAS_2014_12','FCT_TRAF_GPRS_TAS_2015_01','FCT_TRAF_GPRS_TAS_2015_02','FCT_TRAF_GPRS_TAS_2015_03','FCT_TRAF_GPRS_TAS_2015_04','FCT_TRAF_GPRS_TAS_2015_05','FCT_TRAF_GPRS_TAS_2015_06','FCT_TRAF_GPRS_TAS_2015_07','FCT_TRAF_GPRS_TAS_2015_08','FCT_TRAF_GPRS_TAS_2015_09','FCT_TRAF_GPRS_TAS_2015_10','FCT_TRAF_GPRS_TAS_2015_11','FCT_TRAF_GPRS_TAS_2015_11_BKP','FCT_TRAF_GPRS_TAS_2015_12','FCT_TRAF_GPRS_TAS_2016_01','FCT_TRAF_GPRS_TAS_2016_02','FCT_TRAF_GPRS_TAS_2016_03','FCT_TRAF_GPRS_TAS_2016_04','ODS_DATOS_IN_PRE_0902','ODS_DATOS_IN_PRE_0903','ODS_DATOS_IN_PRE_0904','ODS_FACT_CRED_CAB_0902','ODS_FACT_CRED_CAB_0903','ODS_FACT_CRED_CAB_0904','ODS_GPRS_HOTBILLING_0902','ODS_GPRS_HOTBILLING_0903','ODS_GPRS_HOTBILLING_0904','ODS_MENSAJE_TAS'
        -- )
        ORDER BY t.table_name;
BEGIN

    FOR tabla IN tablas
    LOOP
        cadena_columnas := '';
        cadena_select := '';
        contador := 0;        

        FOR columna IN (SELECT c.column_name FROM all_tab_cols c WHERE owner = tabla.owner and table_name = tabla.table_name)
        LOOP
            cadena_columnas := cadena_columnas || '|' || columna.column_name ;
            -- cadena_select := '**';    
            -- cadena_select := cadena_select || ',' || columna.column_name;    
            -- cadena_select := cadena_select || ', replace(' || columna.column_name || ', chr(10), '' '')';
            cadena_select := cadena_select || '||''|''||replace(' || columna.column_name || ', chr(10), '' '')';
        END LOOP;
        cadena_columnas := substr(cadena_columnas, 2);
        cadena_select := substr(cadena_select, 8);
        
        output_spool_tabla := lower('spool /oracle/csv_generados/'||nombre_db||'/'||tabla.owner||'/'||nombre_db||'-'||tabla.owner||'.'||tabla.table_name||'.csv');
        select_spool_columnas := 'select ''' || cadena_columnas || '''' || chr(10) ||  '  from dual';
        select_spool_datos := 'select /*+ PARALLEL(' || tabla.owner  || '.' || tabla.table_name || ',4)*/ ' || cadena_select || chr(10) || '  from ' || tabla.owner  || '.' || tabla.table_name;
        
        dbms_output.put_line(output_spool_tabla);
        dbms_output.put_line('/');
        dbms_output.put_line(select_spool_columnas);
        dbms_output.put_line('/');
        dbms_output.put_line(select_spool_datos);
        dbms_output.put_line('/' || chr(10) || chr(10));
    
    END LOOP;
    
EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line('ERROR: ' || SQLERRM);
END;
/
spool off
/
EXIT
EOFEOF
